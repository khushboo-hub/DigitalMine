{% extends "base.html" %}
{% block content %}
{% load static %}
<style>
    @media print {
        h3.page-header 
        {
<!--            font-size: 1em;-->
        }
        body{
            height:0%;
        }
        div.main{
        padding-top:0%;
        }
        input#button,input#print,div.spacer,div#form-not-print {
            display: none !important;
        }
    }

</style>
<div class="container">
    <div class="row">
        <section class="col-md-12">

            <!-- Table content -->
            <div class="row" id="form-not-print">
                <h3 class="page-header"><b>STATUS REPORT ON PROGRESS MADE INTO MITIGATION OF ALL THE IDENTIFIED
                    PRINCIPAL
                    HAZARDS.
                </b></h3>
                <div class="form-group">
                    <form class="form-horizontal" method="post" enctype="multipart/form-data">{% csrf_token %}
                        <fieldset class="scheduler-border">
                            <legend class="scheduler-border">
                                <font color="blue"> Mine Details</font>
                            </legend>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="col-md-4">
                                        <label>
                                            1.0 Name of the Mine:
                                        </label>
                                    </div>
                                    <div class="col-md-8">
                                        {{form.mine}}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="col-md-4">
                                        <label>
                                            2.0 Name of the Owner:
                                        </label>
                                    </div>
                                    <div class="col-md-8">
                                        <select name="owner" class="form-control" required="" id="id_owner">
                                            <option value="" selected="">---------</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <br>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="col-md-4">
                                        <label>
                                            3.0 Name of the Agent:
                                        </label>
                                    </div>
                                    <div class="col-md-8">
                                        <select name="agent" class="form-control" required="" id="id_agent">
                                            <option value="" selected="">---------</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="col-md-4">
                                        <label>
                                            4.0 Name of the Manager:
                                        </label>
                                    </div>
                                    <div class="col-md-8">
                                        <select name="manager" class="form-control" required="" id="id_manager">
                                            <option value="" selected="">---------</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <br>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="col-md-4">
                                        <label>
                                            5.0 Status report for the quarter ending on:
                                        </label>
                                    </div>
                                    <div class="col-md-8">
                                        <div class='input-group date' id='datepicker'>
                                            {{form.status_report}}
                                            <span class="input-group-addon">
                                                <span class="glyphicon glyphicon-calendar"></span>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <br>
                            <div class="text-center">
                                <input type="submit" value="Submit"/>
                            </div>
                    </form>
                    </fieldset>
                </div>
            </div>
            <div class="row">
                <div id="printablediv">

                    <div class="form-group">

                        <h3 class="page-header text-center"><b>STATUS REPORT ON PROGRESS MADE INTO MITIGATION OF ALL THE
                            IDENTIFIED
                            PRINCIPAL
                            HAZARDS</h3>
                        </b>
                        <h3 class="page-header">
                            <b>******************************************************************************************************
                        </h3></b>

                        <form class="form-horizontal" method="post" enctype="multipart/form-data">{% csrf_token %}
                            <fieldset class="scheduler-border">
                                <legend class="scheduler-border"></legend>
                                <div class="row">
                                    <div class="col-md-6">
                                        <label>
                                            1.0 Name of the Mine:
                                        </label>
                                        {{mine}}

                                    </div>
                                    <div class="col-md-6">
                                        <label>2.0 Name of the Owner:</label>
                                        {{owner}}
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <label>3.0 Name of the Agent:</label>
                                        {{agent}}
                                    </div>
                                    <div class="col-md-6">
                                        <label>4.0 Name of the Manager:</label>
                                        {{manager}}
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <label>5.0 Status report for the quarter ending on:</label>
                                        {{status_report}}
                                    </div>
                                </div>
                                <br>
                                <div class="table-responsive">
                                    <table class="table table-bordered" id="content">
                                        <thead>
                                        <th>Sl. No</th>
                                        <th>List of Principal Hazard identified</th>
                                        <th>Mitigation date as per formulated SMP.</th>
                                        <th>Details of auditable work plan made for mitigation</th>
                                        <th>Actual date of completion as per work plan</th>
                                        <th>Remarks,if any</th>
                                        </thead>
                                        <tbody>
                                        {% for safe in safetytable %}
                                        {% for s in safe %}
                                        <tr>
                                            <td>{{forloop.parentloop.counter}}.{{forloop.counter}}</td>
                                            <td>{{s.print_hazard}}</td>
                                            <td>{{s.mit_date}}</td>
                                            <td>{{s.auditable_work}}</td>
                                            <td>{{s.comp_date}}</td>
                                            <td>{{s.remarks}}</td>
                                        </tr>
                                        {% endfor %}
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                                <br>
                                <br>
                                <span>Signature with date of the Manager</span>
                                <span style="float: right;">Signature with date of the Agent</span>
                                <br>
                                <br>
                                <br>
                                <br>
                                <br>
                                <div class="text-center">Signature with date of the Owner</div>
                            </fieldset>
                            <br>
                            <div class="text-center"><input id="print" type="button" value="PRINT"/></div>
                        </form>
                    </div>
                    </form>
                </div>
            </div>
    </div>
</div>
</section>
<style>
    fieldset.scheduler-border {
        border: solid 1px #DDD !important;
        padding: 0 10px 10px 10px;
        border-bottom: none;
    }

    legend.scheduler-border {
        width: auto !important;
        border: none;
        font-size: 14px;
    }

    fieldset ul {
        list-style: none
    }

</style>
<script>
    $(document).ready(function () {
        $(function () {
            var date_from = $('#datepicker').datetimepicker({
                format: 'YYYY-MM-DD'
            });
            date_from.children()[0].id = "id_date_fr";
            date_from.children()[0].required = "true";
        });
    });

</script>
<script>
    $(document).ready(function () {
        $('select#id_mine').on('change', function () {
            let mine_id = $(this).val();
            $.ajax({
                url: "{% url 'safety:fetch_dropdownlist' %}",
                data: {
                    'id': mine_id
                },
                beforeSend: function () {
                    $('select#id_owner').empty()
                    $('select#id_owner').append($('<option></option>').val("").html("--------------"));
                    $('select#id_agent').empty()
                    $('select#id_agent').append($('<option></option>').val("").html("---------------"));
                    $('select#id_manager').empty()
                    $('select#id_manager').append($('<option></option>').val("").html("--------------"));
                },
                success: function (response) {
                    console.log(response);
                    if (response.hasOwnProperty('result')) {
                        data = response.result;
                        let Owner = data.owner;
                        let Agent = data.agent;
                        let Manager = data.manager;
                        for (owner in Owner) {
                            if (Owner.hasOwnProperty(owner)) {
                                $('select#id_owner').append($('<option></option>').val(Owner[owner].name).html(Owner[owner].name));
                            }
                        }
                        for (agent in Agent) {
                            if (Agent.hasOwnProperty(agent)) {
                                $('select#id_agent').append($('<option></option>').val(Agent[agent].name).html(Agent[agent].name));
                            }
                        }
                        for (manager in Manager) {
                            if (Manager.hasOwnProperty(manager)) {
                                $('select#id_manager').append($('<option></option>').val(Manager[manager].name).html(Manager[manager].name));
                            }
                        }
                    }
                }
            });
        })
        $('input#print').click(function(){
        window.print();
        })
    })

</script>
{% endblock %}