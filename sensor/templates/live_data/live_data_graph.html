{% extends "base.html" %}

{% block content %}

    <div class="container">
{#        <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>#}
{#        <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>#}
{#        <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>#}

        <div class="row">
            <section class="col-md-12">
                <h1 class="page-header">Sensor Live Graph:</h1>
                <div class="row ">
                    <div class="form-group">
                        <form class="form-horizontal" method="post" enctype="multipart/form-data">{% csrf_token %}
                            <div class="form-group col-md-12">
                                <div class="col-md-12">
                                    <div class="col-md-2">
                                        <label for="" class="" id="">Choose Mine:</label>
                                    </div>
                                    <div class="col-md-4" style="padding:0;">
                                        {{ form.mine_id }}
                                    </div>
                                    <div class="col-md-2">
                                        <label for="" class="" id="id_mode_id">Choose Mode:</label>
                                    </div>
                                    <div class="col-md-4" >
                                        <select class="form-control" id="id_mode">
                                            <option>--Select Mode--</option>
                                        </select>
                                    </div>
                                    <br><br><br><br>
                                    <div class="col-md-2">
                                        <label for="" class="" id="name_id">Choose Sensor:</label>
                                    </div>
                                    <div class="col-md-4" >
                                        <select class="form-control" id="id_name">
                                            <option>--Select Sensor--</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-12">

                                    <div class="col-md-2">
                                        <label for="" class="" id="node_id" style="padding:0;">Choose Node:</label>
                                    </div>
                                    <div class="col-md-4">
                                        <select class="form-control" id="id_location_list">
                                            <option>--Select Node--</option>
                                        </select>
                                    </div>
                                    <div class="col-md-2">
                                        <label for="" class="" id="sensor_id" style="padding:0;">Choose Sensor:</label>
                                    </div>
                                    <div class="col-md-4">
                                        <select class="form-control" id="id_sensor_list">
                                            <option>--Select Sensor--</option>
                                        </select>
                                    </div>

                                </div>

                            </div>
                        </form>
                        <div class="row">

                        </div>
                        <div class="col-md-12">
                            <br>
                            <br>
                            <div class="text-center">
                                <input type="button" id="btn_show" class="btn btn-primary" value="Show"/>
                            </div>
                        </div>
                        <!--<div class="col-md-12" style="margin-top:15px;">-->
                        <!--<div class="col-md-4">-->
                        <!--<label for="" class="" id="">Wireless data is comming from IP:</label>-->
                        <!--</div>-->
                        <!--<div class="col-md-4">-->
                        <!--<input type="text" class="form-control" readonly id="ip_hidden">-->
                        <!--</div>-->

                        <!--</div>-->

                        <div class="col-md-12" style="margin-top:15px;">
                            <div class="table-responsive">
                                <div id="graph"></div>
                            </div>
                        </div>
                        <div class="col-md-12" style="margin-top:15px;">
                            <div class="table-responsive">
                                <div id="graph_CH4"></div>
                            </div>
                        </div>
                        <div class="col-md-12" style="margin-top:15px;">
                            <div class="table-responsive">
                                <div id="graph_CO"></div>
                            </div>
                        </div>
                        <div class="col-md-12" style="margin-top:15px;">
                            <div class="table-responsive">
                                <div id="graph_CO2"></div>
                            </div>
                        </div>
                        <div class="col-md-12" style="margin-top:15px;">
                            <div class="table-responsive">
                                <div id="graph_O2"></div>
                            </div>
                        </div>
                        <div class="col-md-12" style="margin-top:15px;">
                            <div class="table-responsive">
                                <div id="graph_H2S"></div>
                            </div>
                        </div>
                        <div class="col-md-12" style="margin-top:15px;">
                            <div class="table-responsive">
                                <div id="graph_NO2"></div>
                            </div>
                        </div>
                        <div class="col-md-12" style="margin-top:15px;">
                            <div class="table-responsive">
                                <div id="graph_SO2"></div>
                            </div>
                        </div>
                        <div class="col-md-12" style="margin-top:15px;">
                            <div class="table-responsive">
                                <div id="graph_H2"></div>
                            </div>
                        </div>
                        <div class="col-md-12" style="margin-top:15px;">
                            <div class="table-responsive" id="table1">
                            </div>
                        </div>

                    </div>
                </div>
            </section>
        </div>
    </div>


    <script>
        $("#id_mine_id").addClass('form-control');
        {#$("#node_id").hide();#}
        {#$("#id_location_list").hide();#}
        {#$("#sensor_id").hide();#}
        {#$("#id_sensor_list").hide();#}
        {#$("#id_mode_id").hide();#}
        {#$("#id_mode").hide();#}
        {#$("#name_id").hide();#}
        {#$("#id_name").hide();#}
        $("#id_mine_id").on("change", function () {
            $("#id_mode").html("<option>--Select Mode--</option>");
            $("#id_mode").append($("<option />").text('Node Wise'));
            $("#id_mode").append($("<option />").text('Sensor Wise'));
            $("#id_mode_id").show();
            $("#id_mode").show();
        });
        //
        $("#id_mode").on("click", function () {
            if ($("#id_mode").val() == "Node Wise") {
                $("#name_id").hide();
                $("#id_name").hide();
                $("#node_id").show();
                $("#id_location_list").show();
                mine_id = $("#id_mine_id").val();

                $.ajax({
                    type: "get",
                    url: "{% url 'sensor:fetch_mine_ajax' %}",
                    data: {
                        'id': mine_id
                    },
                    success: function (data) {
                        //console.log(data.result);
                        //alert(data.result[0]);
                        fill_dropdown(data.result);

                        return data;
                    },
                    error: function () {
                        console.log("error he ji");
                    }
                });
            } else if ($("#id_mode").val() == "Sensor Wise") {
                $("#node_id").hide();
                $("#id_location_list").hide();
                $("#sensor_id").hide();
                $("#id_sensor_list").hide();

                function_fill_dropdown_sensor_all();
            }
        });

        function fill_dropdown(result) {
            $("#id_location_list").html("<option>--Select Node--</option>");
            for (index = 0; index < result.length; index++) {
                //alert(result[index]);
                var str_array = result[index].split(',');
                //alert("id="+str_array[0]+":name="+str_array[1]);
                $("#id_location_list").append($("<option />").val(str_array[0]).text(str_array[1]));
            }
        }

        $("#id_location_list").on("change", function () {
            $("#sensor_id").show();
            $("#id_sensor_list").show();
            location_id = this.value;
            $.ajax({
                type: "get",
                url: "{% url 'sensor:fetch_sensor_ajax' %}",
                data: {
                    'id': location_id
                },
                success: function (data) {
                    //console.log(data.result);
                    //alert(data.result[0]);
                    fill_dropdown_sensor(data.result);

                    return data;
                },
                error: function () {
                    console.log("error he ji");
                }
            });
        });

        function fill_dropdown_sensor(result) {
            $("#id_sensor_list").html("<option>--Select Sensor--</option>");
            for (index = 0; index < result.length; index++) {
                //alert(result[index]);
                var str_array = result[index].split(',');
                //alert("id="+str_array[0]+":name="+str_array[1]);
                $("#id_sensor_list").append($("<option />").val(str_array[0]).text(str_array[1]));
            }

            $("#id_sensor_list").append($("<option />").text('All Sensor'));
        }

        function function_fill_dropdown_sensor_all() {
            $("#name_id").show();
            $("#id_name").show();
            $("#id_name").html("<option>--Select Mode--</option>");
            $("#id_name").append($("<option />").text('CH4'));
            $("#id_name").append($("<option />").text('CO'));
            $("#id_name").append($("<option />").text('CO2'));
            $("#id_name").append($("<option />").text('H2'));
            $("#id_name").append($("<option />").text('H2S'));
            $("#id_name").append($("<option />").text('NO2'));
            $("#id_name").append($("<option />").text('O2'));
            $("#id_name").append($("<option />").text('SO2'));
        }

        $("#btn_show").click(function () {
            $("#btn_show").val("Please wait...");
            $("#btn_show").prop('disabled', true);
            if ($("#id_mode").val() == 'Node Wise') {
                sensor_id = $("#id_sensor_list").val();
                location_id = $("#id_location_list").val();
                //alert(sensor_id)
                ///$("#ip_hidden").val(" ");//empty the IP address on each click
                //alert(sensor_id);
                // $("#X"+i).hide();
                // $("#graph_CO").empty();
                // $("#graph_CO2").empty();
                // $("#graph_H2").empty();
                // $("#graph_H2S").empty();
                // $("#graph_NO2").empty();
                // $("#graph_O2").empty();
                // $("#graph_SO2").empty();
                // $("#graph").empty();
                if (sensor_id == 'All Sensor') {
                    //alert(location_id);
                    $.ajax({
                        type: "get",
                        url: "{% url 'sensor:fetch_sensor_values_all_ajax' %}",
                        data: {
                            'id': location_id
                        },
                        success: function (data) {
                            //alert(data.result);
                            fill_all(data.result);
                            return data;
                        },
                        error: function () {
                            //alert("Something Went Wrong!");
                            console.log("error");
                        }
                    });


                } else {
                    $.ajax({
                        type: "get",
                        url: "{% url 'sensor:fetch_sensor_ajax_sensor' %}",
                        data: {
                            'id': sensor_id
                        },
                        success: function (data) {
                            for (index = 0; index < data.result1.length; index++) {
                                var str_array = data.result1[index].split(',');
                            }
                            name = str_array[1];
                            unit = str_array[2];
                            level = str_array[3];
                            fill_graph_sensor(name, unit, level);

                            return data;
                        },
                        error: function () {
                            console.log("error he ji");
                        }
                    });
                }
            } else if ($("#id_mode").val() == "Sensor Wise") {
                sensor1 = $("#id_name").val();
                //alert(sensor1);
                mine_id = $("#id_mine_id").val();
                //alert(mine_id);
                fill_graph_sensor_node(sensor1, mine_id);
            }
        });

        function fill_graph_sensor(name, unit, level) {
            function rand() {
                x = 0;
                return x;
            }

            var time = new Date();
            var data = [{
                x: [time],
                y: [rand()],
                mode: 'lines+markers',
                marker: {color: level, size: 8},
                line: {width: 4},
                name: '<b>No Data Found</b>'

            }]
            var layout = {
                title: {
                    text: '<b>Live Sensor<i>(' + name + ')</i>Graph</b>',
                    font: {
                        family: 'Courier New, monospace',
                        size: 34

                    },
                    xref: 'paper',
                    x: 0.05,

                },
                xaxis: {
                    title: {
                        text: '<b>Time</b>',
                        font: {
                            family: 'Courier New, monospace',
                            size: 22,
                            color: '#060216'
                        }
                    },
                },
                yaxis: {
                    title: {
                        text: '<b>' + unit + '</b>',
                        font: {
                            family: 'Courier New, monospace',
                            size: 22,
                            color: '#060216'
                        }
                    }
                },
                showlegend: true,
                legend: {
                    x: 4,
                    y: 4
                }
            };

            Plotly.react('graph', data, layout);

            var cnt = 0;
            var interval = setInterval(function () {
                $.ajax({
                    type: "get",
                    url: "{% url 'sensor:fetch_sensor_values_ajax' %}",
                    data: {
                        'id': sensor_id
                    },
                    success: function (data) {
                        console.log(data);
                        for (index = 0; index < data.result.length; index++) {
                            var str_array = data.result[index].split(',');
                        }
                        level1 = data.result1[0];
                        warning = data.result2[0];
                        result = str_array[5]

                        function getData() {
                            x = result;
                            return x;
                        }

                        var time = new Date();
//var  marker='';

                        var update = {
                            'marker.color': level1,
                            name: '<b>' + warning + '<b>',

                            type: 'scatter'

                        }
                        var update1 = {
                            x: [[time]],
                            y: [[getData()]]
                        }
                        var olderTime = time.setMinutes(time.getMinutes() - 1);
                        var futureTime = time.setMinutes(time.getMinutes() + 1);

                        var minuteView = {
                            xaxis: {
                                title: {
                                    text: '<b>Time</b>',
                                    font: {
                                        family: 'Courier New, monospace',
                                        size: 22,
                                        color: '#060216'
                                    }
                                },
                                type: '<b>date</b>',
                                range: [olderTime, futureTime],


                            }
                        };

                        Plotly.relayout('graph', minuteView);
                        //Plotly.extendTraces('graph', update, [0])
                        Plotly.restyle('graph', update);
                        Plotly.extendTraces('graph', update1, [0]);
// cnt = cnt+1;
                        if (cnt === 100) clearInterval(interval);
                    }
                });
            }, 500);
            $("#btn_show").val("Show");
            $("#btn_show").prop('disabled', false);
        }

        ////////////////////////////////////////////////////
        function fill_all(result) {
            var x;
            var y;
            for (x in result) {
                y = result[x];
                if (y == "CH4") {

                    $.ajax({
                        type: "get",
                        url: "{% url 'sensor:fetch_sensor_values_ajax_CH4' %}",
                        data: {
                            'id': location_id,
                            'id1': y
                        },
                        success: function (data) {
                            for (index = 0; index < data.result1.length; index++) {
                                var str_array = data.result1[index].split(',');
                            }
                            name = str_array[0];
                            unit = str_array[1];
                            fill_graph_sensor_CH4(name, unit);
                            return data;
                        }
                    });

                } else if (y == "CO") {
                    $.ajax({
                        type: "get",
                        url: "{% url 'sensor:fetch_sensor_values_ajax_CO' %}",
                        data: {
                            'id': location_id,
                            'id1': y
                        },
                        success: function (data) {
                            for (index = 0; index < data.result1.length; index++) {
                                var str_array = data.result1[index].split(',');
                            }
                            name = str_array[0];
                            unit = str_array[1];
                            fill_graph_sensor_CO(name, unit);

                            return data;
                        }
                    });

                } else if (y == "CO2") {
                    $.ajax({
                        type: "get",
                        url: "{% url 'sensor:fetch_sensor_values_ajax_CO2' %}",
                        data: {
                            'id': location_id,
                            'id1': y
                        },
                        success: function (data) {
                            for (index = 0; index < data.result1.length; index++) {
                                var str_array = data.result1[index].split(',');
                            }
                            name = str_array[0];
                            unit = str_array[1];
                            fill_graph_sensor_CO2(name, unit);
                            return data;
                        }
                    });

                } else if (y == "O2") {

                    $.ajax({
                        type: "get",
                        url: "{% url 'sensor:fetch_sensor_values_ajax_O2' %}",
                        data: {
                            'id': location_id,
                            'id1': y
                        },
                        success: function (data) {
                            for (index = 0; index < data.result1.length; index++) {
                                var str_array = data.result1[index].split(',');
                            }
                            name = str_array[0];
                            unit = str_array[1];
                            fill_graph_sensor_O2(name, unit);
                            return data;
                        }
                    });

                } else if (y == "H2S") {
                    $.ajax({
                        type: "get",
                        url: "{% url 'sensor:fetch_sensor_values_ajax_H2S' %}",
                        data: {
                            'id': location_id,
                            'id1': y
                        },
                        success: function (data) {
                            for (index = 0; index < data.result1.length; index++) {
                                var str_array = data.result1[index].split(',');
                            }
                            name = str_array[0];
                            unit = str_array[1];
                            fill_graph_sensor_H2S(name, unit);
                            return data;
                        }
                    });

                } else if (y == "NO2") {
                    $.ajax({
                        type: "get",
                        url: "{% url 'sensor:fetch_sensor_values_ajax_NO2' %}",
                        data: {
                            'id': location_id,
                            'id1': y
                        },
                        success: function (data) {
                            for (index = 0; index < data.result1.length; index++) {
                                var str_array = data.result1[index].split(',');
                            }
                            name = str_array[0];
                            unit = str_array[1];
                            fill_graph_sensor_NO2(name, unit);
                            return data;
                        }
                    });

                } else if (y == "SO2") {
                    $.ajax({
                        type: "get",
                        url: "{% url 'sensor:fetch_sensor_values_ajax_SO2' %}",
                        data: {
                            'id': location_id,
                            'id1': y
                        },
                        success: function (data) {
                            for (index = 0; index < data.result1.length; index++) {
                                var str_array = data.result1[index].split(',');
                            }
                            name = str_array[0];
                            unit = str_array[1];
                            fill_graph_sensor_SO2(name, unit);
                            return data;
                        }
                    });

                } else if (y == "H2") {
                    $.ajax({
                        type: "get",
                        url: "{% url 'sensor:fetch_sensor_values_ajax_H2' %}",
                        data: {
                            'id': location_id,
                            'id1': y
                        },
                        success: function (data) {
                            for (index = 0; index < data.result1.length; index++) {
                                var str_array = data.result1[index].split(',');
                            }
                            name = str_array[0];
                            unit = str_array[1];
                            fill_graph_sensor_H2(name, unit);
                            return data;
                        }
                    });

                } else {
                    //fill_graph_sensor_He();
                }


            }
        }

        function fill_graph_sensor_CH4(name, unit) {
            function rand() {
                x = 0;
                return x;
            }

            var time = new Date();
            var data = [{
                x: [time],
                y: [rand()],
                mode: 'lines+markers',
                marker: {color: '#1216f6', size: 8},
                line: {width: 4},
                name: '<b>No Data Found</b>'
            }]
            var layout = {
                title: {
                    text: '<b>Live Sensor<i>(' + name + ')</i> Graph</b>',
                    font: {
                        family: 'Courier New, monospace',
                        size: 34

                    },
                    xref: 'paper',
                    x: 0.05,

                },
                xaxis: {
                    title: {
                        text: '<b>Time</b>',
                        font: {
                            family: 'Courier New, monospace',
                            size: 22,
                            color: '#000000'
                        }
                    },
                },
                yaxis: {
                    title: {
                        text: '<b>' + unit + '</b>',
                        font: {
                            family: 'Courier New, monospace',
                            size: 22,
                            color: '#000000'
                        }
                    }
                },
                showlegend: true,
                legend: {
                    x: 4,
                    y: 4
                }
            };

            Plotly.react('graph_CH4', data, layout);

            var cnt = 0;
            var interval = setInterval(function () {
                $.ajax({
                    type: "get",
                    url: "{% url 'sensor:fetch_sensor_values_ajax_CH4' %}",
                    data: {
                        'id': location_id,
                        'id1': name
                    },
                    success: function (data) {
                        console.log(data);
                        for (index = 0; index < data.result.length; index++) {
                            var str_array = data.result[index];
                        }
                        level_ch4 = data.result3[0];
                        warning_ch4 = data.result2[0];
                        result = str_array

                        function getData() {
                            x = result;
                            return x;
                        }

                        var time = new Date();
                        var update = {
                            'marker.color': level_ch4,
                            name: '<b>' + warning_ch4 + '<b>',
                            type: 'scatter'

                        }
                        var update1 = {
                            x: [[time]],
                            y: [[getData()]]

                        }

                        var olderTime = time.setMinutes(time.getMinutes() - 1);
                        var futureTime = time.setMinutes(time.getMinutes() + 1);

                        var minuteView = {
                            xaxis: {
                                title: {
                                    text: '<b>Time</b>',
                                    font: {
                                        family: 'Courier New, monospace',
                                        size: 22,
                                        color: '#000000'
                                    }
                                },
                                type: '<b>date</b>',
                                range: [olderTime, futureTime]
                            }
                        };

                        Plotly.relayout('graph_CH4', minuteView);
                        Plotly.restyle('graph_CH4', update);
                        Plotly.extendTraces('graph_CH4', update1, [0]);
                        cnt = cnt + 1;
                        if (cnt === 100) clearInterval(interval);
                    }
                });
            }, 5000);
            $("#btn_show").val("Show");
            $("#btn_show").prop('disabled', false);
        }

        /////////
        function fill_graph_sensor_CO(name, unit) {
            function rand() {
                x = 0;
                return x;
            }

            var time = new Date();
            var data = [{
                x: [time],
                y: [rand()],
                mode: 'lines+markers',
                marker: {color: '#1216f6', size: 8},
                line: {width: 4},
                name: '<b>No Data Found</b>'
            }]
            var layout = {
                title: {
                    text: '<b>Live Sensor<i>(' + name + ')</i> Graph</b>',
                    font: {
                        family: 'Courier New, monospace',
                        size: 34

                    },
                    xref: 'paper',
                    x: 0.05,

                },
                xaxis: {
                    title: {
                        text: '<b>Time</b>',
                        font: {
                            family: 'Courier New, monospace',
                            size: 22,
                            color: '#060216'
                        }
                    },
                },
                yaxis: {
                    title: {
                        text: '<b>' + unit + '</b>',
                        font: {
                            family: 'Courier New, monospace',
                            size: 22,
                            color: '#060216'
                        }
                    }
                },
                showlegend: true,
                legend: {
                    x: 4,
                    y: 4
                }
            };

            Plotly.react('graph_CO', data, layout);

            var cnt = 0;
            var interval = setInterval(function () {
                $.ajax({
                    type: "get",
                    url: "{% url 'sensor:fetch_sensor_values_ajax_CO' %}",
                    data: {
                        'id': location_id,
                        'id1': name
                    },
                    success: function (data) {
                        for (index = 0; index < data.result.length; index++) {
                            var str_array = data.result[index];
                        }
                        level_CO = data.result3[0];
                        warning_CO = data.result2[0];
                        result = str_array

                        function getData() {
                            x = result;
                            return x;
                        }

                        var time = new Date();
                        var update = {
                            'marker.color': level_CO,
                            name: '<b>' + warning_CO + '<b>',
                            type: 'scatter'

                        }
                        var update1 = {
                            x: [[time]],
                            y: [[getData()]]

                        }

                        var olderTime = time.setMinutes(time.getMinutes() - 1);
                        var futureTime = time.setMinutes(time.getMinutes() + 1);

                        var minuteView = {
                            xaxis: {
                                title: {
                                    text: '<b>Time</b>',
                                    font: {
                                        family: 'Courier New, monospace',
                                        size: 22,
                                        color: '#060216'
                                    }
                                },
                                type: '<b>date</b>',
                                range: [olderTime, futureTime]
                            }
                        };

                        Plotly.relayout('graph_CO', minuteView);
                        Plotly.restyle('graph_CO', update);
                        Plotly.extendTraces('graph_CO', update1, [0])

                        if (cnt === 100) clearInterval(interval);
                    }
                });
            }, 5000);
            $("#btn_show").val("Show");
            $("#btn_show").prop('disabled', false);
        }

        ///////
        function fill_graph_sensor_CO2(name, unit) {
            function rand() {
                x = 0;
                return x;
            }

            var time = new Date();
            var data = [{
                x: [time],
                y: [rand()],
                mode: 'lines+markers',
                marker: {color: '#1216f6', size: 8},
                line: {width: 4},
                name: '<b>No Data Found</b>'
            }]
            var layout = {
                title: {
                    text: '<b>Live Sensor<i>(' + name + ')</i> Graph</b>',
                    font: {
                        family: 'Courier New, monospace',
                        size: 34

                    },
                    xref: 'paper',
                    x: 0.05,

                },
                xaxis: {
                    title: {
                        text: '<b>Time</b>',
                        font: {
                            family: 'Courier New, monospace',
                            size: 22,
                            color: '#060216'
                        }
                    },
                },
                yaxis: {
                    title: {
                        text: '<b>' + unit + '</b>',
                        font: {
                            family: 'Courier New, monospace',
                            size: 22,
                            color: '#060216'
                        }
                    }
                },
                showlegend: true,
                legend: {
                    x: 4,
                    y: 4
                }
            };

            Plotly.react('graph_CO2', data, layout);

            var cnt = 0;
            var interval = setInterval(function () {
                $.ajax({
                    type: "get",
                    url: "{% url 'sensor:fetch_sensor_values_ajax_CO2' %}",
                    data: {
                        'id': location_id,
                        'id1': name
                    },
                    success: function (data) {
                        for (index = 0; index < data.result.length; index++) {
                            var str_array = data.result[index];
                        }
                        level_CO2 = data.result3[0];
                        warning_CO2 = data.result2[0];
                        result = str_array

                        function getData() {
                            x = result;
                            return x;
                        }

                        var time = new Date();
                        var update = {
                            'marker.color': level_CO2,
                            name: '<b>' + warning_CO2 + '<b>',
                            type: 'scatter'

                        }
                        var update1 = {
                            x: [[time]],
                            y: [[getData()]]

                        }

                        var olderTime = time.setMinutes(time.getMinutes() - 1);
                        var futureTime = time.setMinutes(time.getMinutes() + 1);

                        var minuteView = {
                            xaxis: {
                                title: {
                                    text: '<b>Time</b>',
                                    font: {
                                        family: 'Courier New, monospace',
                                        size: 22,
                                        color: '#060216'
                                    }
                                },
                                type: '<b>date</b>',
                                range: [olderTime, futureTime]
                            }
                        };

                        Plotly.relayout('graph_CO2', minuteView);
                        Plotly.restyle('graph_CO2', update);
                        Plotly.extendTraces('graph_CO2', update1, [0])

                        if (cnt === 100) clearInterval(interval);
                    }
                });
            }, 5000);
            $("#btn_show").val("Show");
            $("#btn_show").prop('disabled', false);
        }

        ///////
        function fill_graph_sensor_O2(name, unit) {
            function rand() {
                x = 0;
                return x;
            }

            var time = new Date();
            var data = [{
                x: [time],
                y: [rand()],
                mode: 'lines+markers',
                marker: {color: '#1216f6', size: 8},
                line: {width: 4},
                name: '<b>No Data Found</b>'
            }]
            var layout = {
                title: {
                    text: '<b>Live Sensor<i>(' + name + ')</i> Graph</b>',
                    font: {
                        family: 'Courier New, monospace',
                        size: 34

                    },
                    xref: 'paper',
                    x: 0.05,

                },
                xaxis: {
                    title: {
                        text: '<b>Time</b>',
                        font: {
                            family: 'Courier New, monospace',
                            size: 22,
                            color: '#060216'
                        }
                    },
                },
                yaxis: {
                    title: {
                        text: '<b>' + unit + '</b>',
                        font: {
                            family: 'Courier New, monospace',
                            size: 22,
                            color: '#060216'
                        }
                    }
                },
                showlegend: true,
                legend: {
                    x: 4,
                    y: 4
                }
            };

            Plotly.react('graph_O2', data, layout);

            var cnt = 0;
            var interval = setInterval(function () {
                $.ajax({
                    type: "get",
                    url: "{% url 'sensor:fetch_sensor_values_ajax_O2' %}",
                    data: {
                        'id': location_id,
                        'id1': name
                    },
                    success: function (data) {
                        for (index = 0; index < data.result.length; index++) {
                            var str_array = data.result[index];
                        }
                        level_O2 = data.result3[0];
                        warning_O2 = data.result2[0];
                        result = str_array

                        function getData() {
                            x = result;
                            return x;
                        }

                        var time = new Date();
                        var update = {
                            'marker.color': level_O2,
                            name: '<b>' + warning_O2 + '<b>',
                            type: 'scatter'

                        }
                        var update1 = {
                            x: [[time]],
                            y: [[getData()]]

                        }

                        var olderTime = time.setMinutes(time.getMinutes() - 1);
                        var futureTime = time.setMinutes(time.getMinutes() + 1);

                        var minuteView = {
                            xaxis: {
                                title: {
                                    text: '<b>Time</b>',
                                    font: {
                                        family: 'Courier New, monospace',
                                        size: 22,
                                        color: '#060216'
                                    }
                                },
                                type: '<b>date</b>',
                                range: [olderTime, futureTime]
                            }
                        };

                        Plotly.relayout('graph_O2', minuteView);
                        Plotly.restyle('graph_O2', update);
                        Plotly.extendTraces('graph_O2', update1, [0])

                        if (cnt === 100) clearInterval(interval);
                    }
                });
            }, 5000);
            $("#btn_show").val("Show");
            $("#btn_show").prop('disabled', false);
        }

        //////
        function fill_graph_sensor_H2S(name, unit) {
            function rand() {
                x = 0;
                return x;
            }

            var time = new Date();
            var data = [{
                x: [time],
                y: [rand()],
                mode: 'lines+markers',
                marker: {color: '#1216f6', size: 8},
                line: {width: 4},
                name: '<b>No Data Found</b>'
            }]
            var layout = {
                title: {
                    text: '<b>Live Sensor<i>(' + name + ')</i> Graph</b>',
                    font: {
                        family: 'Courier New, monospace',
                        size: 34

                    },
                    xref: 'paper',
                    x: 0.05,

                },
                xaxis: {
                    title: {
                        text: '<b>Time</b>',
                        font: {
                            family: 'Courier New, monospace',
                            size: 22,
                            color: '#060216'
                        }
                    },
                },
                yaxis: {
                    title: {
                        text: '<b>' + unit + '</b>',
                        font: {
                            family: 'Courier New, monospace',
                            size: 22,
                            color: '#060216'
                        }
                    }
                },
                showlegend: true,
                legend: {
                    x: 4,
                    y: 4
                }
            };

            Plotly.react('graph_H2S', data, layout);

            var cnt = 0;
            var interval = setInterval(function () {
                $.ajax({
                    type: "get",
                    url: "{% url 'sensor:fetch_sensor_values_ajax_H2S' %}",
                    data: {
                        'id': location_id,
                        'id1': name
                    },
                    success: function (data) {
                        for (index = 0; index < data.result.length; index++) {
                            var str_array = data.result[index];
                        }
                        level_H2S = data.result3[0];
                        warning_H2S = data.result2[0];
                        result = str_array

                        function getData() {
                            x = result;
                            return x;
                        }

                        var time = new Date();
                        var update = {
                            'marker.color': level_H2S,
                            name: '<b>' + warning_H2S + '<b>',
                            type: 'scatter'

                        }
                        var update1 = {
                            x: [[time]],
                            y: [[getData()]]

                        }

                        var olderTime = time.setMinutes(time.getMinutes() - 1);
                        var futureTime = time.setMinutes(time.getMinutes() + 1);

                        var minuteView = {
                            xaxis: {
                                title: {
                                    text: '<b>Time</b>',
                                    font: {
                                        family: 'Courier New, monospace',
                                        size: 22,
                                        color: '#060216'
                                    }
                                },
                                type: '<b>date</b>',
                                range: [olderTime, futureTime]
                            }
                        };

                        Plotly.relayout('graph_H2S', minuteView);
                        Plotly.restyle('graph_H2S', update);
                        Plotly.extendTraces('graph_H2S', update1, [0])

                        if (cnt === 100) clearInterval(interval);
                    }
                });
            }, 5000);
            $("#btn_show").val("Show");
            $("#btn_show").prop('disabled', false);
        }

        //////
        function fill_graph_sensor_NO2(name, unit) {
            function rand() {
                x = 0;
                return x;
            }

            var time = new Date();
            var data = [{
                x: [time],
                y: [rand()],
                mode: 'lines+markers',
                marker: {color: '#1216f6', size: 8},
                line: {width: 4},
                name: '<b>No Data Found</b>'
            }]
            var layout = {
                title: {
                    text: '<b>Live Sensor<i>(' + name + ')</i> Graph</b>',
                    font: {
                        family: 'Courier New, monospace',
                        size: 34

                    },
                    xref: 'paper',
                    x: 0.05,

                },
                xaxis: {
                    title: {
                        text: '<b>Time</b>',
                        font: {
                            family: 'Courier New, monospace',
                            size: 22,
                            color: '#060216'
                        }
                    },
                },
                yaxis: {
                    title: {
                        text: '<b>' + unit + '</b>',
                        font: {
                            family: 'Courier New, monospace',
                            size: 22,
                            color: '#060216'
                        }
                    }
                },
                showlegend: true,
                legend: {
                    x: 4,
                    y: 4
                }
            };

            Plotly.react('graph_NO2', data, layout);

            var cnt = 0;
            var interval = setInterval(function () {
                $.ajax({
                    type: "get",
                    url: "{% url 'sensor:fetch_sensor_values_ajax_NO2' %}",
                    data: {
                        'id': location_id,
                        'id1': name
                    },
                    success: function (data) {
                        for (index = 0; index < data.result.length; index++) {
                            var str_array = data.result[index];
                        }
                        level_NO2 = data.result3[0];
                        warning_NO2 = data.result2[0];
                        result = str_array

                        function getData() {
                            x = result;
                            return x;
                        }

                        var time = new Date();
                        var update = {
                            'marker.color': level_NO2,
                            name: '<b>' + warning_NO2 + '<b>',
                            type: 'scatter'

                        }
                        var update1 = {
                            x: [[time]],
                            y: [[getData()]]

                        }

                        var olderTime = time.setMinutes(time.getMinutes() - 1);
                        var futureTime = time.setMinutes(time.getMinutes() + 1);

                        var minuteView = {
                            xaxis: {
                                title: {
                                    text: '<b>Time</b>',
                                    font: {
                                        family: 'Courier New, monospace',
                                        size: 22,
                                        color: '#060216'
                                    }
                                },
                                type: '<b>date</b>',
                                range: [olderTime, futureTime]
                            }
                        };

                        Plotly.relayout('graph_NO2', minuteView);
                        Plotly.restyle('graph_NO2', update);
                        Plotly.extendTraces('graph_NO2', update1, [0])

                        if (cnt === 100) clearInterval(interval);
                    }
                });
            }, 5000);
            $("#btn_show").val("Show");
            $("#btn_show").prop('disabled', false);
        }

        //////
        function fill_graph_sensor_SO2(name, unit) {
            function rand() {
                x = 0;
                return x;
            }

            var time = new Date();
            var data = [{
                x: [time],
                y: [rand()],
                mode: 'lines+markers',
                marker: {color: '#1216f6', size: 8},
                line: {width: 4},
                name: '<b>No Data Found</b>'
            }]
            var layout = {
                title: {
                    text: '<b>Live Sensor<i>(' + name + ')</i> Graph</b>',
                    font: {
                        family: 'Courier New, monospace',
                        size: 34

                    },
                    xref: 'paper',
                    x: 0.05,

                },
                xaxis: {
                    title: {
                        text: '<b>Time</b>',
                        font: {
                            family: 'Courier New, monospace',
                            size: 22,
                            color: '#060216'
                        }
                    },
                },
                yaxis: {
                    title: {
                        text: '<b>' + unit + '</b>',
                        font: {
                            family: 'Courier New, monospace',
                            size: 22,
                            color: '#060216'
                        }
                    }
                },
                showlegend: true,
                legend: {
                    x: 4,
                    y: 4
                }
            };

            Plotly.react('graph_SO2', data, layout);

            var cnt = 0;
            var interval = setInterval(function () {
                $.ajax({
                    type: "get",
                    url: "{% url 'sensor:fetch_sensor_values_ajax_SO2' %}",
                    data: {
                        'id': location_id,
                        'id1': name
                    },
                    success: function (data) {
                        for (index = 0; index < data.result.length; index++) {
                            var str_array = data.result[index];
                        }
                        level_SO2 = data.result3[0];
                        warning_SO2 = data.result2[0];
                        result = str_array

                        function getData() {
                            x = result;
                            return x;
                        }

                        var time = new Date();
                        var update = {
                            'marker.color': level_SO2,
                            name: '<b>' + warning_SO2 + '<b>',
                            type: 'scatter'

                        }
                        var update1 = {
                            x: [[time]],
                            y: [[getData()]]

                        }

                        var olderTime = time.setMinutes(time.getMinutes() - 1);
                        var futureTime = time.setMinutes(time.getMinutes() + 1);

                        var minuteView = {
                            xaxis: {
                                title: {
                                    text: '<b>Time</b>',
                                    font: {
                                        family: 'Courier New, monospace',
                                        size: 22,
                                        color: '#060216'
                                    }
                                },
                                type: '<b>date</b>',
                                range: [olderTime, futureTime]
                            }
                        };

                        Plotly.relayout('graph_SO2', minuteView);
                        Plotly.restyle('graph_SO2', update);
                        Plotly.extendTraces('graph_SO2', update1, [0])

                        if (cnt === 100) clearInterval(interval);
                    }
                });
            }, 5000);
            $("#btn_show").val("Show");
            $("#btn_show").prop('disabled', false);
        }

        //////
        function fill_graph_sensor_H2(name, unit) {
            function rand() {
                x = 0;
                return x;
            }

            var time = new Date();
            var data = [{
                x: [time],
                y: [rand()],
                mode: 'lines+markers',
                marker: {color: '#1216f6', size: 8},
                line: {width: 4},
                name: '<b>No Data Found</b>'
            }]
            var layout = {
                title: {
                    text: '<b>Live Sensor<i>(' + name + ')</i> Graph</b>',
                    font: {
                        family: 'Courier New, monospace',
                        size: 34

                    },
                    xref: 'paper',
                    x: 0.05,

                },
                xaxis: {
                    title: {
                        text: '<b>Time</b>',
                        font: {
                            family: 'Courier New, monospace',
                            size: 22,
                            color: '#060216'
                        }
                    },
                },
                yaxis: {
                    title: {
                        text: '<b>' + unit + '</b>',
                        font: {
                            family: 'Courier New, monospace',
                            size: 22,
                            color: '#060216'
                        }
                    }
                },
                showlegend: true,
                legend: {
                    x: 4,
                    y: 4
                }
            };

            Plotly.react('graph_H2', data, layout);

            var cnt = 0;
            var interval = setInterval(function () {
                $.ajax({
                    type: "get",
                    url: "{% url 'sensor:fetch_sensor_values_ajax_H2' %}",
                    data: {
                        'id': location_id,
                        'id1': name
                    },
                    success: function (data) {
                        for (index = 0; index < data.result.length; index++) {
                            var str_array = data.result[index];
                        }
                        level_H2 = data.result3[0];
                        warning_H2 = data.result2[0];
                        result = str_array

                        function getData() {
                            x = result;
                            return x;
                        }

                        var time = new Date();
                        var update = {
                            'marker.color': level_H2,
                            name: '<b>' + warning_H2 + '<b>',
                            type: 'scatter'

                        }
                        var update1 = {
                            x: [[time]],
                            y: [[getData()]]

                        }

                        var olderTime = time.setMinutes(time.getMinutes() - 1);
                        var futureTime = time.setMinutes(time.getMinutes() + 1);

                        var minuteView = {
                            xaxis: {
                                title: {
                                    text: '<b>Time</b>',
                                    font: {
                                        family: 'Courier New, monospace',
                                        size: 22,
                                        color: '#060216'
                                    }
                                },
                                type: '<b>date</b>',
                                range: [olderTime, futureTime]
                            }
                        };

                        Plotly.relayout('graph_H2', minuteView);
                        Plotly.restyle('graph_H2', update);
                        Plotly.extendTraces('graph_H2', update1, [0])

                        if (cnt === 100) clearInterval(interval);
                    }
                });
            }, 5000);
            $("#btn_show").val("Show");
            $("#btn_show").prop('disabled', false);
        }

        ///////for sensor node
        function fill_graph_sensor_node(sensor1, mine_id) {
            $.ajax({
                type: "get",
                url: "{% url 'sensor:sensor_wise_node' %}",
                data: {
                    'id': sensor1,
                    'id1': mine_id
                },
                success: function (data) {
                    x4 = data.result.length;
                    //alert(x4);
                    var i;
                    // for (i in data.result3 ) {
                    //     ;
                    // }
                    for (i = 0; i < x4; i++) {
                        $('<div>', {id: "X" + i}).appendTo($("#table1"));
                        $('<br><br>').appendTo($("#table1"));
                        //alert(i);
                        var index = data.result3[i]
                        var index1 = data.result2[i]
                        var index2 = data.result1[i]
                        fill_graph_sensor_node_all(i, sensor1, mine_id, index, index1, index2);
                    }

                    return data;
                }
            });
        }

        function fill_graph_sensor_node_all(i, sensor1, mine_id, index, index1, index2) {
            function rand() {
                x1 = 0;
                return x1;
            }

            var time = new Date();
            var data = [{
                x: [time],
                y: [rand()],
                mode: 'lines+markers',
                marker: {color: '#1216f6', size: 8},
                line: {width: 4},
                name: '<b>No Data Found</b>'
            }]
            var layout = {
                title: {
                    text: '<b>Live Graph for Sensor(' + index2 + ') in (' + index + ')</b>',
                    font: {
                        family: 'Courier New, monospace',
                        size: 34

                    },
                    xref: 'paper',
                    x: 0.05,

                },
                xaxis: {
                    title: {
                        text: '<b>Time</b>',
                        font: {
                            family: 'Courier New, monospace',
                            size: 22,
                            color: '#060216'
                        }
                    },
                },
                yaxis: {
                    title: {
                        text: '<b>' + index1 + '</b>',
                        font: {
                            family: 'Courier New, monospace',
                            size: 22,
                            color: '#060216'
                        }
                    }
                },
                showlegend: true,
                legend: {
                    x: 4,
                    y: 4
                }
            };

            Plotly.react('X' + i, data, layout);

            var cnt = 0;
            var interval = setInterval(function () {
                $.ajax({
                    type: "get",
                    url: "{% url 'sensor:sensor_wise_node' %}",
                    data: {
                        'id': sensor1,
                        'id1': mine_id
                    },
                    success: function (data) {
                        var str_array = data.result[i];
                        var str_array1 = data.result4[i];
                        var str_array2 = data.result5[i];

                        result = str_array

                        function getData() {
                            x2 = result;
                            return x2;
                        }

                        var time = new Date();
                        var update = {
                            'marker.color': str_array1,
                            name: '<b>' + str_array2 + '<b>',
                            type: 'scatter'

                        }
                        var update1 = {
                            x: [[time]],
                            y: [[getData()]]

                        }

                        var olderTime = time.setMinutes(time.getMinutes() - 1);
                        var futureTime = time.setMinutes(time.getMinutes() + 1);

                        var minuteView = {
                            xaxis: {
                                title: {
                                    text: '<b>Time</b>',
                                    font: {
                                        family: 'Courier New, monospace',
                                        size: 22,
                                        color: '#060216'
                                    }
                                },
                                type: '<b>date</b>',
                                range: [olderTime, futureTime]
                            }
                        };

                        Plotly.relayout('X' + i, minuteView);
                        Plotly.restyle('X' + i, update);
                        Plotly.extendTraces('X' + i, update1, [0])

                        if (cnt === 100) clearInterval(interval);
                    }
                });
            }, 5000);
            $("#btn_show").val("Show");
            $("#btn_show").prop('disabled', false);
        }
    </script>
{% endblock %}


